<div class="goal-node details">

<div class="back-button">
  <%= link_to goal_path(:goal_id => @goal.hashid, :view => 'public') do %>
    <div class="back-button-arrow"></div>
    <div class="back-button-content">
      View in map
    </div>
  <% end %>
</div>

<h1><%= @goal.title %></h1>
<br><br>

<div class="goal-details-section">

<% if @goal.id != 1 %>

  <h2>Adopted by</h2>
  <ul>
  <% @public_parents.each do |link| %>
    <% link.user.each do |user| %>
      <li>
        <i class="fas fa-link"></i>
        <%= user.name %>
      </li>
    <% end %>
  <% end %>

  </ul>

  <h2>Marked Achieved by</h2>
  <ul>
  <% @goal.users.each do |user| %>
    <li>
      <i class="fas fa-check-double"></i>
      <%= user.name %>
    </li>
  <% end %>
  </ul>
</div>

<div class="goal-details-section">
  <h2>Parent goals</h2>
  <ul>
  <% @public_parents.each do |link| %>
    <% if link.parent.id == 1 %>
      <li class="details-subgoal">
        <%= link_to link.parent.title, goal_details_path(link.parent) %><br>
      </li>
    <% else %>
      <li class="details-subgoal">
  <!--       <%= link_to link.parent.title, goal_path(link.parent) %><br>
        <i class="fas fa-user-friends"></i>
        <%= link.user.count %> -->
        <%= render(:partial => 'link_unlink_links_detailed_parent', :locals => {:link => link, :@goal => @goal, :view => 'public'}) %>
      </li>
    <% end %>
  <% end %>
  </ul>
<!-- </div>

<div class="goal-details-section"> -->
  <h2>Subgoals</h2>

  <div class="btn-group dropright">
    <button type="button" class="button add" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <i class="fas fa-plus"></i> Add a subgoal
    </button>
    <div class="dropdown-menu">
      <% @new_goal = Goal.new() %>
      
      <%= form_for(@new_goal, remote: true) do |form| %>
        <div>
          <%= form.text_area :title, id: :goal_title, placeholder: "Add a subgoal" %>
        </div>

        <%= form.hidden_field :parent_id, :value => @goal.id %>

        <% if Setting.find(13).state %>
          <%= form.check_box :post_goal, {checked: true}, true, false %> <label>Post to bulletin</label><br>
        <% end %>

        <%= form.submit "Submit", id: :submit_goal, :class => 'button'%>
      <% end %>
    </div>
  </div>

  <ul>
  <% @public_children.each do |link| %>
    <li class="details-subgoal">
      <!-- <i class="fas fa-user-friends"></i>
      <%= link.user.count %>
      <%= link_to link.child.title, goal_path(link.child) %>   -->
      <%= render(:partial => 'link_unlink_links_detailed', :locals => {:link => link, :@goal => @goal, :view => 'public'}) %>
    <!--   <%= link_to goal_details_path(link.child.id) do %>
        <%= link.child.title %>
      <% end %> -->
    </li>
  <% end %>
  </ul>

</div>

<div class="goal-details-section">
  <!-- <h2>Other</h2> -->

 <!--  <h2>Brainstorms</h2>
  <ul>
  <% Problem.where(:goal_id => @goal.id).each do |brainstorm| %>
    <li>
      <i class="fas fa-brain"></i>
      <%= link_to brainstorm.title, issue_path(brainstorm) %>    
    </li>
  <% end %>
  </ul>   -->

  <h2>Actions</h2>
  <ul>
  <% Activity.where(:goal_id => @goal.id).each do |action| %>
    <li>
      <i class="fas fa-calendar"></i>
      <%= link_to action.title, action_path(action) %>
    </li>
  <% end %>
  </ul>

  <h2>Discussions</h2>
  <ul>
  <% Discussion.where(:goal_id => @goal.id).each do |discussion| %>
    <li>
      <i class="fas fa-comments"></i>
      <%= link_to discussion.title, discussion_path(discussion) %>
    </li>
  <% end %>
  </ul>  
</div>

<% else %>
<div>
  <h2>Top-level goals</h2>
  <ul>
  <% @public_children.each do |link| %>
    <li class="details-subgoal">

      <%= render(:partial => 'link_unlink_links_detailed', :locals => {:link => link, :@goal => @goal, :view => 'public'}) %>

    </li>
  <% end %>
  </ul>
</div>
<% end %>


</div>