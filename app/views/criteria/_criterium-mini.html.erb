<% if criterium.title %>

  <% @user = current_user %>
  <% status_color = "#ff7455d9;;" if criterium.user.include?(@user) %>
  <% status_color = "#05adabab;" if criterium.cridissent.find_by(user: @user) %>

  <div class="criterium" >

    <div class="criterium-top">
      <div class="criterium-title">
        <%= criterium.title %>

        <br>

        <div class="criterion-details">
          <!-- If anyone dissented -->
          <% if criterium.cridissent.count > 0 %>
          <div>
            <span class="show-objections" id="show-objections-<%=criterium.id%>">
              <%= pluralize(criterium.cridissent.count, "Concern") %> (view)
            </span>
          </div>
        <% end %>
          <div class="dissent-stuff">
          <!-- Objections -->
          <% if criterium.cridissent.find_by(user: @user) %>
              <%= link_to assent_criteria_path(:criterium_id => criterium.id), :method => "post" do %>   
                <span class="cridissent-count gray" href="#" aria-label="Remove concern" tabindex="0">
                  â€“ retract concern
                </span>
              <% end %>
          <% else %>
              <span class="cridissent-count submit-concern gray" id="submit-concern-<%=criterium.id%>" href="#" aria-label="Lodge a concern" tabindex="0">
                + add concern
              </span>    

          <% end %>
          </div>
        </div>
      </div>


      <!-- If there's a facilitator -->
      <% if criterium.problem.facilitator_id && logged_in? %>
        <!-- If you are the facilitator -->
        <% if criterium.problem.facilitator_id == @user.id %>
            <div class="criteria-sponsorship">
              <%if criterium.user.include?(@user)%>
                <%= link_to unsponsor_criteria_path(:criterium_id => criterium.id), :method => "post" do %>
                  <span class="crisupport-count gray yellow-background small-button" href="#" tabindex="0">
                    <i class="fas fa-times gray"></i>
                    Remove
                  </span>
                <% end %>
              <%else%>
                <%= link_to sponsor_criteria_path(:criterium_id => criterium.id), :method => "post" do %>
                  <span class="crisupport-count gray small-button green-background" href="#" tabindex="0">
                    <i class="fas fa-plus gray"></i>
                    Add to criteria
                  </span>
                <% end %>

                <!-- &nbsp; -->

                <div>
                <%= link_to destroy_criterium_path(:id => criterium.id), :method => "delete", data: { confirm: 'Are you sure you want to delete this criterion?' } do %>
                  <span class="crisupport-count gray small-button red-background" href="#" tabindex="0">
                    <i class="fas fa-minus-circle gray"></i>
                    Delete
                  </span>
                <% end %>
                </div>

              <% end %>
            </div>
        <!-- If you aren't the facilitator -->
        <%else%>
        <%end%>
      <%end%>
    </div>

  </div>

  <div class="objection-popup" id="objection-<%=criterium.id%>">
    <div class="objection-inner">
      <i class="fas fa-times close-window"></i>
      <h2>What is your concern with the criterion "<%=criterium.title%>"?</h2>

      <div class="criterion-objection-input">
      <%= form_for(criterium.cridissent.new, :url => dissent_criteria_path, remote: true) do |form| %>
        <!-- <div class="dissent-instructions">I cannot support a proposal that meets this criterion because</div> -->
        <%= form.hidden_field :criterium_id %>
        <div class="dissent-title"><%= form.text_area :title%></div>
        <!-- <div class="submit-dissent"> -->
        <div>
          <%= form.submit "Submit", :class => "button" %>
        </div>
      <% end %>
      </div>
    </div>
  </div>

  <div class="objection-list" id="objection-list-<%=criterium.id%>">
    <div class="objection-list-inner">
      <i class="fas fa-times close-window"></i>
      <h2>Concerns about "<%=criterium.title%>"</h2>
      <ul><% criterium.cridissent.each do |dissent| %>
      <li>
        <%if dissent.user%>
          <strong><%= link_to(dissent.user.name, dissent.user) %></strong>:
          <% if dissent.title.length > 0 %>
            <%= dissent.title %>
          <% else %>
            is concerned about this criterion
          <%end%>
        <%end%>
      </li>
    <% end %></ul>
    </div>
  </div>

<%end%>

<script type="text/javascript">
  $('#submit-concern-<%=criterium.id%>').click( function() {
    $('#objection-<%=criterium.id%>').show()
  })

  $('#objection-<%=criterium.id%>').find('.close-window').click(function(){
    $('#objection-<%=criterium.id%>').hide()
  })

  $('#show-objections-<%=criterium.id%>').click( function() {
    $('#objection-list-<%=criterium.id%>').show()
  })

  $('#objection-list-<%=criterium.id%>').find('.close-window').click(function(){
    $('#objection-list-<%=criterium.id%>').hide()
  })
</script>