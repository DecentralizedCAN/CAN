<div id="solver">

  <div class="issue">
    <div class="flex-container">

      <div class="issue-title view"><h3><strong><%= @problem.title %></strong></h3>
      </div>

      <div class="right-buttons">
        <%if @problem.user.include?(@user)%>
          <%= link_to "Leave", unsponsor_problem_path(:problem_id => @problem.id), :method => "post", :class => "button"  %>
        <%else%>
          <%= link_to "Join", sponsor_problem_path(:problem_id => @problem.id), :method => "post", :class => "button"  %>
        <%end%>
      </div>

    </div>

    <% if @problem.goal %>
      <div class="proposal-activity-description">
        <i class="fas fa-link"></i>
        Attached to goal <strong><%= link_to @problem.title, goal_path(@problem.goal) %></strong>
      </div>
    <% end %>

    <div class="issue-info">
      <div class="post-signature">
        <!-- <i class="fas fa-calendar"></i> -->
        Created <%= time_ago_in_words(@problem.created_at) %> ago
        by
        <em><%= 
        begin 
          User.find(@problem.creator).name
        rescue 
        end  %></em>
      </div>
      <br>
      <div>
        <i class="fas fa-handshake"></i>
        <%= @problem.user.count %> collaborators
      </div>
      <div>
        <i class="fas fa-clipboard-list"></i>
        <%= @problem.criterium.count %> criteria
      </div>
      <div>
        <i class="fas fa-comment-alt"></i> 
        <%= @problem.solution.count %> proposals
      </div>

    </div>

    <% if @problem.facilitator_id %>
      <% facilitator = User.find(@problem.facilitator_id) %>
      Facilitator: 
      <%= link_to facilitator.name, facilitator %>
    <% end %>

    </div>

    <% if @problem.description.length > 0 %> 
      <p class="issue-description"><%= @problem.description.gsub(URI.regexp, '<a target="_blank" href="\0">\0</a>').html_safe %></p>
    <% end %>
  </div>


    <!-- DETAILS ENDS -->


<!-- EXTRA-SECTIONS -->

    <!-- CRITERIA -->
    <div class="criteria-outer">

      <h1 id="criteria">
        <i class="fas fa-clipboard-list"></i>
        <%= @criteria_count %> Criteria
      </h1>

      <div>
        <% if @problem.solution.count > 0 && @problem.criterium.count > 0 %>
          <%= link_to brainstorm_table_path( :problem_id => @problem.hashid), :class => "button button-hollow" do %>
            <i class="fas fa-table"></i> Table
          <% end %>
          &nbsp;
        <% end %>

        <% if @problem.criterium.count > (@my_criteria.count + @criteria.count) %>
          <%= link_to full_criterium_path( :problem_id => @problem.id), :class => "button button-hollow" do %>
            <i class="fas fa-clipboard-list"></i> View all
          <% end %>
          &nbsp;
        <% end %>

        <%= link_to "Add criterion", new_criterium_path( :problem_id => @problem.id), :class => "button"  %>
      </div>

      <div id="issue-criteria">

        <div class="criteria-list">
          <% @my_criteria.each do |criterium| %>
            <%= render(:partial => 'criteria/criterium-mini', :locals => {:criterium => criterium})%>
          <% end %>
          <% @criteria.each do |criterium| %>
            <%= render(:partial => 'criteria/criterium-mini', :locals => {:criterium => criterium})%>
          <% end %>
        </div>

      </div>
    </div>

<!-- CRITERIA ENDS -->

<div id="extra-sections-outer">

<!-- SOLUTIONS -->

  <div class="solutions-outer">

    <h1 id="solutions">
      <i class="fas fa-comment-alt"></i>
      <%= @solutions.count %> Proposals
    </h1>

    <div>
      <%= link_to 'Propose action', new_solution_path(:problem_id => @problem.id), :class => "button" if @problem.require_action %>
      <%= link_to 'New proposal', new_solution_path(:problem_id => @problem.id), :class => "button" if !@problem.require_action %>
    </div>
    
    <ol class="solutions">
      <% @solutions.each do |solution| %>
        <li>
          <div class="solution-item">

            <%= link_to solution_path(:problem_id => solution.problem.hashid, :solution_id => solution.hashid) do %>

              <div>
                <strong><%= solution.title %></strong>
              </div>

<<<<<<< HEAD
              <div class="score-bar-outer">
                <div class="score-bar-inner" style="background-color: #9fff77; width: <%= solution.score %>%" ></div>
                <div class="written-criterion-score">
                  <%= (solution_score(solution.id) * 100).to_i %>%
=======
              <% if !@problem.scoring_method || @problem.scoring_method == 1 %>
                <div class="score-bar-outer">
                  <div class="score-bar-inner" style="background-color: #9fff77; width: <%= solution.score %>%" ></div>
                  <div class="written-criterion-score">
                    <%= solution.score %>%
                  </div>
>>>>>>> unity
                </div>
              <% elsif @problem.scoring_method == 2 %>
                (Unmet criteria: 
                <% polls = Poll.where(solution_id: solution.id) if Poll.where(solution_id: solution.id).count > 0 %>
                <span class="percentage" colspan="2"><%= ( 100 - (polls.average(:answer) * 100).round ) if polls %> <%= 0 if !polls %>%</span>)
              <% elsif @problem.scoring_method == 3 %>
                (Met criteria: 
                <% polls = Poll.where(solution_id: solution.id) if Poll.where(solution_id: solution.id).count > 0 %>
                <span class="percentage" colspan="2"><%= ( (polls.average(:answer) * 100).round ) if polls %> <%= 0 if !polls %>%</span>)
              <% end %>

            <% end %>
           

            <% if solution.user.count >= @problem.suggestion_min && solution.activity %>
              <%= link_to action_path(:activity_id => solution.activity.id), class: "button button-view" do %>
                <em>View action</em>
              <% end %>
            <% end %>

          </div>
        </li>
      <% end %>
    </ol>

    <span id="paginate_solutions"><%= will_paginate @solutions %></span>

  </div>

  <!-- </div> -->
<!-- SOLUTIONS ENDS --->

<!-- DISCUSSION -->
  
<%= render(:partial => 'discussions/discussion-mini', :locals => {:@discussion => @discussion}) if Setting.find(4).state %>

<!-- DISCUSSION ENDS -->



</div>
<!-- EXTRA-SECTIONS ENDS -->

</div>